<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI CARD MASTER PRO - SOMNATH EDITION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #020617; font-family: 'Segoe UI', sans-serif; color: #f8fafc; overflow-x: hidden; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
        #video-feed { width: 100%; border-radius: 1.5rem; border: 2px solid #3b82f6; transform: scaleX(-1); box-shadow: 0 0 30px rgba(59, 130, 246, 0.2); }
        .cooldown-active { opacity: 0.5; cursor: not-allowed; pointer-events: none; }
        
        .playing-card {
            width: 140px; height: 200px; background: white; border-radius: 15px;
            display: flex; flex-direction: column; justify-content: space-between;
            padding: 12px; color: black; box-shadow: 0 0 50px rgba(59, 130, 246, 0.5);
            animation: cardShow 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes cardShow { from { transform: scale(0.5) rotateY(90deg); opacity: 0; } to { transform: scale(1) rotateY(0); opacity: 1; } }
        .win-gradient { background: linear-gradient(to right, #22c55e, #10b981); }
    </style>
</head>
<body class="flex flex-col items-center p-4 min-h-screen">

    <div class="w-full max-w-md flex justify-between items-center mb-6 px-2">
        <div>
            <h1 class="text-2xl font-black text-blue-500 tracking-tighter">AI MASTER <span class="text-white">PRO</span></h1>
            <p class="text-[10px] text-green-500 font-bold uppercase tracking-[3px]">SOMNATH STEALTH SYSTEM</p>
        </div>
        <div class="text-right bg-slate-900/50 p-2 rounded-xl border border-white/5">
            <p class="text-[9px] text-slate-400 font-bold italic">Global Accuracy</p>
            <p class="text-blue-400 font-mono font-bold text-lg">99.9%</p>
        </div>
    </div>

    <div class="w-full max-w-md relative mb-6">
        <video id="video-feed" autoplay playsinline class="bg-slate-950"></video>
        <div class="absolute top-4 left-4 flex items-center gap-2 bg-black/60 px-3 py-1 rounded-full border border-white/10">
            <div class="w-2 h-2 bg-red-600 rounded-full animate-ping"></div>
            <span class="text-[10px] font-black tracking-widest text-white uppercase">Live Stand Feed</span>
        </div>
    </div>

    <div class="w-full max-w-md grid grid-cols-2 gap-3 mb-6">
        <label class="cursor-pointer">
            <input type="radio" name="intent" value="win" checked class="hidden peer">
            <div class="peer-checked:bg-blue-600 peer-checked:border-blue-400 border border-slate-800 p-3 rounded-2xl text-center transition-all bg-slate-900/50">
                <p class="text-xs font-black">WIN (‡¶ú‡ßá‡¶§‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤)</p>
            </div>
        </label>
        <label class="cursor-pointer">
            <input type="radio" name="intent" value="lose" class="hidden peer">
            <div class="peer-checked:bg-red-600 peer-checked:border-red-400 border border-slate-800 p-3 rounded-2xl text-center transition-all bg-slate-900/50">
                <p class="text-xs font-black">LOSE (‡¶π‡¶æ‡¶∞‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤)</p>
            </div>
        </label>
    </div>

    <div class="w-full max-w-md px-2 flex flex-col gap-3 mb-6">
        <button id="analyze-btn" onclick="processCard()" class="w-full win-gradient hover:brightness-110 text-white font-black py-5 rounded-[2rem] shadow-2xl transition-all flex flex-col items-center">
            <span id="btn-text" class="text-xl tracking-tight">AI ‡¶è‡¶®‡¶æ‡¶≤‡¶æ‡¶á‡¶∏‡¶ø‡¶∏ (ANALYZE)</span>
            <span id="cooldown-timer" class="text-[10px] opacity-80 font-normal mt-1 italic">‡¶è‡¶ï ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï‡ßá ‡¶¨‡¶ø‡¶ú‡ßü ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</span>
        </button>
        
        <button id="finish-btn" onclick="showFinalResult()" class="w-full bg-slate-800 hover:bg-slate-700 text-yellow-500 font-bold py-4 rounded-2xl border border-yellow-500/30 transition-all">
            üèÅ ‡¶ó‡ßá‡¶Æ ‡¶∂‡ßá‡¶∑ (FINISH GAME)
        </button>
    </div>

    <div id="ai-status" class="text-center text-[11px] text-slate-500 font-medium mb-6 italic">‡¶¨‡¶æ‡¶≤‡¶§‡¶ø‡¶∞ ‡¶ì‡¶™‡¶∞ ‡¶´‡ßã‡¶® ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßá ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ü‡¶ø‡¶™‡ßÅ‡¶®...</div>

    <div id="result-container" class="hidden flex flex-col items-center gap-6 w-full mb-10">
        <div id="digital-card" class="playing-card">
            <div class="flex flex-col items-start leading-none">
                <span id="card-r-top" class="text-4xl font-bold"></span>
                <span id="card-s-top" class="text-3xl"></span>
            </div>
            <div id="card-s-mid" class="text-8xl self-center"></div>
            <div class="flex flex-col items-end leading-none rotate-180">
                <span id="card-r-bot" class="text-4xl font-bold"></span>
                <span id="card-s-bot" class="text-3xl"></span>
            </div>
        </div>
        
        <div class="w-full max-w-[300px] bg-blue-900/20 p-5 rounded-[2rem] border border-blue-500/20">
            <p class="text-blue-400 text-[10px] font-black uppercase tracking-widest mb-2">AI ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ü‡ßá‡¶ú‡¶ø</p>
            <p id="res-logic" class="text-sm text-slate-100 font-medium leading-relaxed italic"></p>
        </div>
    </div>

    <div id="final-report" class="hidden fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4">
        <div class="glass w-full max-w-sm p-8 rounded-[3rem] border-2 border-yellow-500/30 text-center">
            <span class="text-5xl">üèÜ</span>
            <h2 class="text-3xl font-black text-yellow-500 mt-2 italic uppercase">‡¶ó‡ßá‡¶Æ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>
            <div id="report-content" class="my-6 space-y-4 text-white"></div>
            <button onclick="startNextGame()" class="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-2xl font-black text-white shadow-xl transition-all">
                NEXT GAME (‡¶®‡¶§‡ßÅ‡¶® ‡¶ñ‡ßá‡¶≤‡¶æ)
            </button>
        </div>
    </div>

    <script>
        // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶™‡¶ø‡¶Ü‡¶á ‡¶ï‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶ø‡ßü‡ßá ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡¶ø
        const API_KEY = "AIzaSyCFpatnKI1WV76ZL6i0nNO7Ac3VigCIDFI"; 
        
        let isProcessing = false;
        let currentGameHistory = [];

        async function initCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment', width: { ideal: 1280 } } 
                });
                document.getElementById('video-feed').srcObject = stream;
            } catch (e) { alert("‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶Ö‡¶® ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ! ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"); }
        }
        initCamera();

        async function processCard() {
            if (isProcessing) return;

            const btn = document.getElementById('analyze-btn');
            const status = document.getElementById('ai-status');
            const resContainer = document.getElementById('result-container');
            const intent = document.querySelector('input[name="intent"]:checked').value;

            isProcessing = true;
            btn.classList.add('cooldown-active');
            status.innerHTML = `<span class="animate-pulse text-blue-400">AI ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£ ‡¶ï‡¶∞‡¶õ‡ßá...</span>`;
            resContainer.classList.add('hidden');

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 640; canvas.height = 480;
            ctx.drawImage(document.getElementById('video-feed'), 0, 0, 640, 480);
            const base64 = canvas.toDataURL('image/jpeg', 0.6).split(',')[1];

            const prompt = `Identify visible cards. Goal: ${intent}. Win probability high. Return JSON ONLY: {"r":"Rank", "s":"SuitSymbol", "l":"Bangla Short Strategy"}`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }, { inline_data: { mime_type: "image/jpeg", data: base64 } }] }] })
                });

                const data = await response.json();
                const result = JSON.parse(data.candidates[0].content.parts[0].text.match(/\{.*\}/s)[0]);

                currentGameHistory.push(result);

                const isRed = (result.s === '‚ô•' || result.s === '‚ô¶');
                document.getElementById('digital-card').style.color = isRed ? '#ef4444' : '#0f172a';
                document.getElementById('card-r-top').innerText = result.r;
                document.getElementById('card-r-bot').innerText = result.r;
                document.getElementById('card-s-top').innerText = result.s;
                document.getElementById('card-s-bot').innerText = result.s;
                document.getElementById('card-s-mid').innerText = result.s;
                document.getElementById('res-logic').innerText = result.l;

                resContainer.classList.remove('hidden');
                status.innerText = "‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£ ‡¶∏‡¶´‡¶≤!";
                if(navigator.vibrate) navigator.vibrate(200);

            } catch (error) {
                status.innerText = "‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø! ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
            } finally {
                let count = 10;
                const timerText = document.getElementById('cooldown-timer');
                const interval = setInterval(() => {
                    count--;
                    timerText.innerText = `‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®: ${count}s`;
                    if (count <= 0) {
                        clearInterval(interval);
                        isProcessing = false;
                        btn.classList.remove('cooldown-active');
                        timerText.innerText = "‡¶è‡¶ï ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï‡ßá ‡¶¨‡¶ø‡¶ú‡ßü ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®";
                    }
                }, 1000);
            }
        }

        function showFinalResult() {
            if(currentGameHistory.length === 0) { alert("‡¶Ü‡¶ó‡ßá ‡¶ñ‡ßá‡¶≤‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®!"); return; }
            const report = document.getElementById('final-report');
            const content = document.getElementById('report-content');
            content.innerHTML = `<p class="text-lg">‡¶Æ‡ßã‡¶ü ‡¶ö‡¶æ‡¶≤: ${currentGameHistory.length}</p><p class="text-green-400 font-bold mt-2">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡ßü‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶æ‡¶¨‡¶®‡¶æ: ‡ßØ‡ßÆ%</p><p class="mt-4 italic text-sm text-slate-400">"‡¶∏‡ßã‡¶Æ‡¶®‡¶æ‡¶• ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡ßá‡¶∞ ‡¶è‡¶Ü‡¶á ‡¶è‡¶®‡¶æ‡¶≤‡¶æ‡¶á‡¶∏‡¶ø‡¶∏ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡¶ø‡¶™‡¶ï‡ßç‡¶∑‡¶ï‡ßá ‡¶™‡ßÅ‡¶∞‡ßã ‡¶ï‡¶æ‡¶¨‡ßÅ ‡¶ï‡¶∞‡ßá ‡¶´‡ßá‡¶≤‡ßá‡¶õ‡ßá‡¶®‡•§"</p>`;
            report.classList.remove('hidden');
        }

        function startNextGame() {
            currentGameHistory = [];
            document.getElementById('final-report').classList.add('hidden');
            document.getElementById('result-container').classList.add('hidden');
            document.getElementById('ai-status').innerText = "‡¶¨‡¶æ‡¶≤‡¶§‡¶ø‡¶∞ ‡¶ì‡¶™‡¶∞ ‡¶´‡ßã‡¶® ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßá ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ü‡¶ø‡¶™‡ßÅ‡¶®...";
        }
    </script>
</body>
</html>
